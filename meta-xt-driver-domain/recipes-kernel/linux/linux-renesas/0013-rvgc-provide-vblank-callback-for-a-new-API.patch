From 70a956c85b6e2cb6a499da71821f1a7041e96384 Mon Sep 17 00:00:00 2001
From: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
Date: Mon, 5 Apr 2021 20:33:51 +0300
Subject: [PATCH 13/13] rvgc: provide vblank callback for a new API

Signed-off-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
---
 drivers/gpu/drm/rcar-rvgc/rcar_rvgc_pipe.c | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

diff --git a/drivers/gpu/drm/rcar-rvgc/rcar_rvgc_pipe.c b/drivers/gpu/drm/rcar-rvgc/rcar_rvgc_pipe.c
index 2186146d838c..f2a910037656 100644
--- a/drivers/gpu/drm/rcar-rvgc/rcar_rvgc_pipe.c
+++ b/drivers/gpu/drm/rcar-rvgc/rcar_rvgc_pipe.c
@@ -1,6 +1,7 @@
 #include <drm/drmP.h>
 #include <drm/drm_device.h>
 
+#include "rcar_rvgc_kms.h"
 #include "rcar_rvgc_drv.h"
 #include "rcar_rvgc_pipe.h"
 #include <drm/drm_simple_kms_helper.h>
@@ -245,11 +246,29 @@ static int rvgc_display_pipe_prepare_fb(struct drm_simple_display_pipe *pipe,
 	return drm_fb_cma_prepare_fb(&pipe->plane, plane_state);
 }
 
+static int rvgc_display_pipe_enable_vblank(struct drm_simple_display_pipe *pipe)
+{
+	struct rcar_rvgc_pipe *rvgc_pipe = container_of(pipe,
+							struct rcar_rvgc_pipe, drm_simple_pipe);
+
+	return rcar_rvgc_crtc_enable_vblank(pipe->crtc.dev, rvgc_pipe->idx);
+}
+
+static void rvgc_display_pipe_disable_vblank(struct drm_simple_display_pipe *pipe)
+{
+	struct rcar_rvgc_pipe *rvgc_pipe = container_of(pipe,
+							struct rcar_rvgc_pipe, drm_simple_pipe);
+
+	rcar_rvgc_crtc_disable_vblank(pipe->crtc.dev, rvgc_pipe->idx);
+}
+
 static const struct drm_simple_display_pipe_funcs rvgc_pipe_funcs = {
 	.enable = rvgc_pipe_enable,
 	.disable = rvgc_pipe_disable,
 	.update = rvgc_display_pipe_update,
 	.prepare_fb = rvgc_display_pipe_prepare_fb,
+	.enable_vblank = rvgc_display_pipe_enable_vblank,
+	.disable_vblank = rvgc_display_pipe_disable_vblank,
 };
 
 static const u32 rvgc_formats[] = {
-- 
2.31.0

